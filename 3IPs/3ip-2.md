---
3ip: 2
title: Threads: A p2p communication protocol
author: oed@3box.io
discussions-to: https://discordapp.com/invite/Z3f3Cxy
status: Draft
created: 2018-11-20
---

# Threads: A p2p communication protocol

This is the first version of threads. This spec is likely to change.

# Overview

Threads is a feature that enables multiple users to post messages in a sequence. This allows users to communicate asynchronously in many forms. For example it could be used for comments, chats, status updates, etc. The first version of threads uses the [orbitdb logstore](https://github.com/orbitdb/orbit-db/blob/master/API.md#orbitdblognameaddress) to create a log of messages that is eventually consistent.

## Access control

This first version of threads will allow anyone to post, without any ability to remove posts. This is achieved by using `write: ['*']` when creating the store in orbitdb.

OrbitDB is [working on adding](https://github.com/orbitdb/orbit-db/pull/495) support for access controllers. When they are released we can use them for write access to threads, as well as moderation, and potentially other features as well.

## Thread creation
Threads are created inside of [Spaces](./3ip-1.md). A thread has a `name` which could be any string. For example the name could be the address of a contract if you want to create a thread for commenting on that contract. This also means that two different spaces could have their own threads with the same name. When a thread is created it gets the name `3box.thread.<space-name>.<thread-name>` for the orbitdb logstore.

## API

All of the calls below assume that you have opened a space:
```js
const space = box.openSpace('aGoodSpace')
```

**List threads the user has interacted with**
Lists all threads that the user has interacted with. Returns a list of objects that contains the name of the thread and if the thread is currently open (if the orbitdb store for it is open, and we are actively listening for updates).

```js
const threadNames = space.threads.list()
console.log(threadNames)
> [{ name: "3box-chat", open: true }, { name: "Bounties-issue432", open: false }]
```

**Create an existing thread:**
When a thread that hasn't been opened before is opened its orbitdb address is also added to the users space under the key `thread-<thread-name>`.

```js
const thread = await threads.threads.open(<name>)
```

**Create a new thread:**
When a new thread is created its orbitdb address is also added to the users space under the key `thread-<thread-name>`.

```js
const thread = await threads.threads.new(<name>)
```

**Get thread name**
```js
const threadName = thread.name
```

**Posting to a thread:**

```js
await thread.post(<json-object>)
```

**Reading a thread:**

We can probably design this similar to the [orbitdb feed iterator](https://github.com/orbitdb/orbit-db/blob/master/API.md#iteratoroptions-1). 

```js
const threadIterator = thread.iterator()
```

**Watching for updates:**

```js
thread.onPost(post => {})
```
